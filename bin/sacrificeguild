#!/usr/bin/env python

from __future__ import annotations
import sys
import requests
import requests_oauthlib
import json
from oauthlib.oauth2 import BackendApplicationClient
from requests_oauthlib import OAuth2Session
from dotenv import load_dotenv

import argparse
import os
from collections.abc import Sequence

load_dotenv()

WOW_PATH = os.getenv('WOW_PATH')
CHARACTER = os.getenv('CHARACTER')
SERVER = os.getenv('SERVER')
BLIZZARD_CLIENT_ID = os.getenv('BLIZZARD_CLIENT_ID')
BLIZZARD_CLIENT_SECRET = os.getenv('BLIZZARD_CLIENT_SECRET')
BLIZZARD_OAUTH_ENDPOINT = os.getenv('BLIZZARD_OAUTH_ENDPOINT')
BLIZZARD_API_ENDPOINT = os.getenv('BLIZZARD_API_ENDPOINT')


def main(argv: Sequence[str] | None = None) -> int:

    parser = argparse.ArgumentParser()
    # Add arguments here
    args = parser.parse_args(argv)

    dir = os.getcwd()
    print("ThezdinUI Script: " + dir)

    payload = {'grant_type': 'client_credentials'}

    # API Connection
    print("Getting Blizzard Access Token")
    response = requests.post(BLIZZARD_OAUTH_ENDPOINT, data=payload, auth=(
        BLIZZARD_CLIENT_ID, BLIZZARD_CLIENT_SECRET))

    data = json.loads(response.text)

    print(data)

    if response.status_code != 200:
        print("Failed to obtain token from Blizzard: ",
              data['error_description'])
        sys.exit()

    # -------------------------------
    # Now fetch the good stuff..
    # -------------------------------


if __name__ == "__main__":
    raise SystemExit(main())
